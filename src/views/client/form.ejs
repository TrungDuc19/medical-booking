<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Đặt lịch khám</title>

  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
  <link rel="stylesheet" href="/static/client/css/partials.css">
  <link rel="stylesheet" href="/static/client/css/form.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>

<body>

  <%- include('../partials/client/header') %>

  <div class="container">
    <div class="wrapper">
      <div class="form-box-register">
        <h2>Đặt lịch khám</h2>
        <form action="#">
          <div class="row">
            <!-- <div class="form-mb-5">
              <label class="form-label">Họ và tên <span class="text-danger">*</span></label>
              <input class="form-input" type="text" name="fullName" id="fullName" required>
            </div> -->

            <div class="form-mb-5">
              <label class="form-label">Họ và tên <span class="text-danger">*</span></label>
              <input class="form-input" type="text" id="name" placeholder="Họ và tên" />
            </div>
            <div class="form-mb-5">
              <label class=" form-label">Giới tính <span class="text-danger">*</span></label>
              <select class="form-select" name="gender" id="gender" style="width: 100%;" required>
                <option value="" selected>Khác</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-mb-5">
              <label class="form-label">Địa chỉ <span class="text-danger">*</span></label>
              <input class="form-input" type="text" name="address" id="address" required>
            </div>
            <div class="form-mb-5">
              <label class="form-label">Ngày sinh <span class="text-danger">*</span></label>
              <input class="form-input" type="date" name="birthday" id="birthday" required>
            </div>
          </div>
          <div class="row">
            <div class="form-mb-5">
              <label class="form-label">Điện thoại <span class="text-danger">*</span></label>
              <input class="form-input" type="text" name="phone" id="phone" required>
            </div>
            <div class="form-mb-5">
              <label class="form-label">Email <span class="text-danger">*</span></label>
              <input class="form-input" type="text" name="email" id="email">
            </div>
          </div>
          <div class="row">
            <div class="form-mb-5">
              <label class="form-label">Số CMND / CCCD <span class="text-danger">*</span></label>
              <input class="form-input" type="text" name="cardId" id="cardId" required>
            </div>
            <div class="form-mb-5">
              <label class="form-label">Khoa <span class="text-danger">*</span></label>
              <select class="form-select" name="medicalDepartment" id="medicalDepartment" style="width: 100%;" required>
                <option value="" selected>-- Chọn --</option>
                <% departments.forEach(d => { %>
                <option><%= d.name %></option>
                <% }) %>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-mb-5">
              <label class="form-label">Ngày khám <span class="text-danger">*</span></label class="form-label">
              <input class="form-input" type="date" name="medicalDay" id="medicalDay" required>

            </div>
            <div class="form-mb-5">
              <label class="form-label">Giờ khám <span class="text-danger">*</span></label class="form-label">
              <select class="form-select" name="medicalHour" id="medicalHour" style="width: 100%;" required>
                <option value="" selected>-- Chọn --</option>
                <option>7h30 - 8h30</option>
                <option>8h30 - 9h30</option>
                <option>9h30 - 10h30</option>
                <option>10h30 - 11h30</option>
                <option>13h30 - 14h30</option>
                <option>14h30 - 15h30</option>
                <option>15h30 - 16h30</option>
                <option>16h30 - 17h30</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="input-box-2">
              <label class="form-label">Lý do khám <span class="text-danger">*</span></label class="form-label">
              <input class="form-input" type="text" name="reason" required>
            </div>
          </div>
          <div class="row">
            <div class="input-box-2">
              <label class="form-label">Ghi chú</label>
              <input class="form-input" type="text" name="note">
            </div>
          </div>
          <div class="row">
            <button class="form-btn" type="submit">Đăng ký</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const fetchData = async () => {
      const result = await (await fetch('/api/v1/users')).json()
      console.log(result);
    }

    // fetchData();

    const form = document.querySelector('form');
    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const data = {};
      data.fullName = document.getElementById('fullName').value;
      data.gender = document.getElementById('gender').value;
      data.address = document.getElementById('address').value;
      data.birthday = document.getElementById('birthday').value;
      data.phone = document.getElementById('phone').value;
      data.email = document.getElementById('email').value;
      data.cardId = document.getElementById('cardId').value;
      data.medicalDepartment = document.getElementById('medicalDepartment').value;

      // console.log("Du lieu gui len: ", document.getElementById('medicalDay'));

      data.medicalDay = document.getElementById('medicalDay').value;
      data.medicalHour = document.getElementById('medicalHour').value;

      // data["name"] = name.value;

      console.log("Du lieu gui len: ", data);

      // const result = await (await fetch('/api/v1/users', { //fetch 
      //   method: 'POST',
      //   headers: {
      //     "Content-Type": "application/json",
      //   },
      //   body: JSON.stringify(data) //
      // })).json()

      // console.log("Du lieu nhan ve: ", result);
      try {
        let result = await (
          await fetch(`/api/v1/medical-forms`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          })
        ).json();
        if (result.code === 201) {
          setTimeout(() => window.location.reload(), 1000);
        }
      } catch (error) {
        console.log(error);
      }
    })
  </script>


  <%- include('../partials/client/footer') %>

</body>

</html>